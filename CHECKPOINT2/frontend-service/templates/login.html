<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Login / Signup - Project Dashboard</title>
<style>
    body { 
        font-family: Arial, sans-serif; 
        background: #f0f2f5; 
        display: flex; 
        justify-content: center; 
        align-items: center; 
        height: 100vh; 
    }
    .auth-box { 
        background: #fff; 
        padding: 2rem; 
        border-radius: 8px; 
        box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
        width: 300px; 
    }
    h2 { text-align: center; margin-bottom: 1rem; }
    input { width: 100%; padding: 0.5rem; margin: 0.5rem 0; border: 1px solid #ccc; border-radius: 4px; }
    button { width: 100%; padding: 0.5rem; background: #4cc9f0; border: none; border-radius: 4px; color: white; cursor: pointer; }
    button:hover { background: #3cb0dc; }
    .toggle-link { display: block; text-align: center; margin-top: 1rem; cursor: pointer; color: #4cc9f0; }
    .toggle-link:hover { text-decoration: underline; }
    .hidden { display: none; }
</style>
</head>
<body>
<div class="auth-box">

    <!-- LOGIN SECTION -->
    <div id="login-section">
        <h2>Login</h2>
        <form id="login-form" method="post" action="/login">
            <input type="text" name="username" placeholder="Username" required>
            <input type="password" name="password" placeholder="Password" required>
            <button type="submit">Login</button>
        </form>
        <span class="toggle-link" onclick="toggleForms()">Don't have an account? Sign up</span>
    </div>

    <!-- SIGNUP SECTION -->
    <div id="signup-section" class="hidden">
        <h2>Signup</h2>
        <form id="signup-form" method="post" action="/signup">
            <input type="text" name="username" placeholder="Username" required>
            <input type="password" name="password" placeholder="Password" required>
            <button type="submit">Sign Up</button>
        </form>
        <span class="toggle-link" onclick="toggleForms()">Already have an account? Login</span>
    </div>

</div>

<script>
function toggleForms() {
    const login = document.getElementById('login-section');
    const signup = document.getElementById('signup-section');
    login.classList.toggle('hidden');
    signup.classList.toggle('hidden');
}

// AUTO LOGIN AFTER SIGNUP
document.getElementById('signup-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    const formData = new FormData(this);
    const username = formData.get('username');
    const password = formData.get('password');

    // Signup request
    const res = await fetch('/signup', {
        method: 'POST',
        body: new URLSearchParams({username, password}),
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
    });

    if(res.ok) {
        // Prebaci na login
        toggleForms();

        // Auto-login
        const loginRes = await fetch('/login', {
            method: 'POST',
            body: new URLSearchParams({username, password}),
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
        });

        if(loginRes.ok) {
            window.location.href = '/'; // redirect u dashboard
        } else {
            alert("Login failed after signup.");
        }
    } else {
        const data = await res.json();
        alert(data.detail || "Signup failed");
    }
});
</script>
</body>
</html>
